---
import { experiences } from '../data/experiences';

const currentExperience = experiences[0];
---

<div class="spectrum-container">
  <div class="experience-layout">
    <div class="nav-arrow nav-arrow-left" data-direction="prev">
      <div class="arrow-triangle"></div>
    </div>

    <div class="experience-card">
      <div class="card-left">
        <div class="company-logo">
          <img src={currentExperience.logo} alt={`${currentExperience.company} logo`} />
        </div>
        <div class="company-info">
          <h3 class="company-name">{currentExperience.company}</h3>
          <p class="position">{currentExperience.position}</p>
          <p class="dates">{currentExperience.startDate} - {currentExperience.endDate}</p>
        </div>
      </div>
      <div class="card-right">
        <div class="description">
          <p>{currentExperience.description}</p>
        </div>
        {currentExperience.technologies && (
          <div class="technologies">
            <h4>Tecnologías:</h4>
            <div class="tech-tags">
              {currentExperience.technologies.map(tech => (
                <span class="tech-tag">{tech}</span>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>

    <div class="nav-arrow nav-arrow-right" data-direction="next">
      <div class="arrow-triangle"></div>
    </div>
  </div>
</div>

<style>
  .experience-layout {
    display: flex;
    align-items: flex-start;
    justify-content: center;
    gap: calc(var(--u) * 0.02);
    height: 100%;
    padding: calc(var(--u) * 0.02);
    position: relative;
    padding-top: calc(var(--u) * 0.02);
  }

  .experience-card {
    display: grid;
    grid-template-columns: minmax(0, 1fr) minmax(0, 2fr);
    background: var(--spectrum-white);
    border: calc(var(--u) * 0.003) solid var(--spectrum-black);
    padding: calc(var(--u) * 0.02);
    width: calc(var(--u) * 0.7);
    height: calc(var(--u) * 0.45);
    max-height: calc(100vh - calc(var(--u) * 0.4));
    overflow: hidden;
    flex-shrink: 0;
    box-sizing: border-box;
  }

  .card-left {
    display: flex;
    flex-direction: column;
    gap: calc(var(--u) * 0.015);
    align-items: center;
    text-align: center;
    padding-right: calc(var(--u) * 0.015);
    min-width: 0;
    border-right: calc(var(--u) * 0.004) solid var(--spectrum-black);
    overflow: hidden;
    height: 100%;
    box-sizing: border-box;
  }

  .company-logo {
    width: calc(var(--u) * 0.12);
    height: calc(var(--u) * 0.12);
    border: calc(var(--u) * 0.002) solid var(--spectrum-black);
    display: flex;
    align-items: center;
    justify-content: center;
    background: var(--spectrum-white);
    flex-shrink: 0;
  }

  .company-logo img {
    width: 80%;
    height: 80%;
    object-fit: contain;
  }

  .company-info {
    display: flex;
    flex-direction: column;
    gap: calc(var(--u) * 0.01);
    flex: 1;
    min-width: 0;
  }

  .company-name {
    font-size: 1.2em;
    font-weight: bold;
    color: var(--spectrum-black);
    margin: 0;
    word-wrap: break-word;
  }

  .position {
    font-size: 1em;
    color: var(--spectrum-black);
    margin: 0;
    word-wrap: break-word;
  }

  .dates {
    font-size: 0.9em;
    color: var(--spectrum-black);
    opacity: 0.8;
    margin: 0;
  }

  .card-right {
    display: flex;
    flex-direction: column;
    gap: calc(var(--u) * 0.015);
    padding-left: calc(var(--u) * 0.015);
    overflow: hidden;
    min-width: 0;
    height: 100%;
    box-sizing: border-box;
  }

  .description {
    font-size: 1em;
    line-height: 1.4;
    color: var(--spectrum-black);
    margin: 0;
    overflow: hidden;
  }

  .description p {
    margin: 0;
    word-wrap: break-word;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: normal;
  }

  .technologies {
    overflow: hidden;
  }

  .technologies h4 {
    font-size: 1em;
    margin: 0 0 calc(var(--u) * 0.01) 0;
    color: var(--spectrum-black);
  }

  .tech-tags {
    display: flex;
    flex-wrap: wrap;
    gap: calc(var(--u) * 0.005);
    overflow: hidden;
  }

  .tech-tag {
    background: var(--spectrum-cyan);
    color: var(--spectrum-black);
    padding: calc(var(--u) * 0.005) calc(var(--u) * 0.01);
    font-size: 0.8em;
    border: calc(var(--u) * 0.001) solid var(--spectrum-black);
    white-space: nowrap;
  }

  .nav-arrow {
    width: calc(var(--u) * 0.08);
    height: calc(var(--u) * 0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: opacity 0.2s ease;
    position: relative;
    z-index: 10;
    flex-shrink: 0;
    background: transparent;
    align-self: center;
  }

  .nav-arrow:hover {
    opacity: 0.7;
  }

  .nav-arrow.hidden {
    opacity: 0.3;
    cursor: not-allowed;
    pointer-events: none;
  }

  .arrow-triangle {
    width: 0;
    height: 0;
    border-style: solid;
  }

  .nav-arrow-left .arrow-triangle {
    border-width: calc(var(--u) * 0.015) calc(var(--u) * 0.015) calc(var(--u) * 0.015) 0;
    border-color: transparent var(--spectrum-black) transparent transparent;
  }

  .nav-arrow-right .arrow-triangle {
    border-width: calc(var(--u) * 0.015) 0 calc(var(--u) * 0.015) calc(var(--u) * 0.015);
    border-color: transparent transparent transparent var(--spectrum-black);
  }
</style>

<script>
  const experiences = [
    {
      id: 'experience-1',
      company: 'TechCorp Solutions',
      logo: '/images/companies/techcorp-logo.png',
      position: 'Senior Full Stack Developer',
      startDate: '2022-01',
      endDate: '2023-12',
      description: 'Desarrollo de aplicaciones web modernas utilizando React, Node.js y TypeScript. Lideré un equipo de 5 desarrolladores en la creación de una plataforma de e-commerce que procesó más de 1M de transacciones mensuales.',
      technologies: ['React', 'Node.js', 'TypeScript', 'PostgreSQL', 'AWS']
    },
    {
      id: 'experience-2',
      company: 'StartupHub',
      logo: '/images/companies/startuphub-logo.png',
      position: 'Lead Developer',
      startDate: '2020-03',
      endDate: '2021-12',
      description: 'Desarrollo de MVP y prototipos para startups emergentes. Implementé arquitecturas escalables y optimicé el rendimiento de aplicaciones críticas. Colaboré estrechamente con equipos de diseño y producto.',
      technologies: ['Vue.js', 'Python', 'Django', 'MongoDB', 'Docker']
    },
    {
      id: 'experience-3',
      company: 'Digital Innovations',
      logo: '/images/companies/digitalinnovations-logo.png',
      position: 'Frontend Developer',
      startDate: '2018-06',
      endDate: '2020-02',
      description: 'Desarrollo de interfaces de usuario responsivas y accesibles. Trabajé en proyectos para clientes internacionales, implementando las mejores prácticas de UX/UI y optimización de rendimiento.',
      technologies: ['JavaScript', 'CSS3', 'HTML5', 'Angular', 'Sass']
    }
  ];

  let currentIndex = 0;

  function updateDisplay() {
    const experience = experiences[currentIndex];
    const card = document.querySelector('.experience-card');
    
    if (card) {
      card.innerHTML = `
        <div class="card-left">
          <div class="company-logo">
            <img src="${experience.logo}" alt="${experience.company} logo" />
          </div>
          <div class="company-info">
            <h3 class="company-name">${experience.company}</h3>
            <p class="position">${experience.position}</p>
            <p class="dates">${experience.startDate} - ${experience.endDate}</p>
          </div>
        </div>
        <div class="card-right">
          <div class="description">
            <p>${experience.description}</p>
          </div>
          ${experience.technologies ? `
            <div class="technologies">
              <h4>Tecnologías:</h4>
              <div class="tech-tags">
                ${experience.technologies.map(tech => `<span class="tech-tag">${tech}</span>`).join('')}
              </div>
            </div>
          ` : ''}
        </div>
      `;
    }

    const leftArrow = document.querySelector('.nav-arrow-left');
    const rightArrow = document.querySelector('.nav-arrow-right');

    if (leftArrow) {
      leftArrow.classList.toggle('hidden', currentIndex === 0);
    }

    if (rightArrow) {
      rightArrow.classList.toggle('hidden', currentIndex === experiences.length - 1);
    }
  }

  function previousExperience() {
    if (currentIndex > 0) {
      currentIndex--;
      updateDisplay();
    }
  }

  function nextExperience() {
    if (currentIndex < experiences.length - 1) {
      currentIndex++;
      updateDisplay();
    }
  }

  function goHome() {
    window.location.href = '/';
  }

  document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('keydown', (e) => {
      switch(e.key) {
        case 'ArrowLeft':
          e.preventDefault();
          previousExperience();
          break;
        case 'ArrowRight':
          e.preventDefault();
          nextExperience();
          break;
        case 'Escape':
        case 'Backspace':
          e.preventDefault();
          goHome();
          break;
      }
    });

    document.querySelectorAll('.nav-arrow').forEach(arrow => {
      arrow.addEventListener('click', (e) => {
        const target = e.currentTarget;
        if (target && target instanceof HTMLElement) {
          const direction = target.dataset.direction;
          if (direction === 'prev') {
            previousExperience();
          } else if (direction === 'next') {
            nextExperience();
          }
        }
      });
    });

    let startX = 0;
    let endX = 0;

    document.addEventListener('touchstart', (e) => {
      startX = e.touches[0].clientX;
    });

    document.addEventListener('touchend', (e) => {
      endX = e.changedTouches[0].clientX;
      const diff = startX - endX;
      if (Math.abs(diff) > 50) {
        if (diff > 0) {
          nextExperience();
        } else {
          previousExperience();
        }
      }
    });

    let isDragging = false;
    let startMouseX = 0;

    document.addEventListener('mousedown', (e) => {
      isDragging = true;
      startMouseX = e.clientX;
    });

    document.addEventListener('mouseup', (e) => {
      if (isDragging) {
        const endMouseX = e.clientX;
        const diff = startMouseX - endMouseX;
        
        if (Math.abs(diff) > 50) {
          if (diff > 0) {
            nextExperience();
          } else {
            previousExperience();
          }
        }
        isDragging = false;
      }
    });

    updateDisplay();
  });
</script>
