

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cómo utiliza Doctrine la capa DBAL &mdash; symfony-docs-es v1 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="symfony-docs-es v1 documentation" href="../../index.html" />
    <link rel="up" title="Recetario" href="../index.html" />
    <link rel="next" title="Cómo trabajar con varios administradores de entidad" href="multiple_entity_managers.html" />
    <link rel="prev" title="Cómo generar entidades de una base de datos existente" href="reverse_engineering.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="multiple_entity_managers.html" title="Cómo trabajar con varios administradores de entidad"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="reverse_engineering.html" title="Cómo generar entidades de una base de datos existente"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Recetario</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="como-utiliza-doctrine-la-capa-dbal">
<span id="index-0"></span><h1>Cómo utiliza Doctrine la capa DBAL<a class="headerlink" href="#como-utiliza-doctrine-la-capa-dbal" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Este artículo es sobre la capa DBAL de Doctrine. Normalmente, vas a trabajar con el nivel superior de la capa ORM de Doctrine, la cual simplemente utiliza DBAL detrás del escenario para comunicarse realmente con la base de datos. Para leer más sobre el ORM de Doctrine, consulta &#8220;<a class="reference internal" href="../../book/doctrine.html"><em>Bases de datos y Doctrine (&#8220;el modelo&#8221;)</em></a>&#8221;.</p>
</div>
<p><a class="reference external" href="http://www.doctrine-project.org/projects/dbal/2.0/docs/en">Doctrine</a> la capa de abstracción de base de datos (DataBase Abstraction Layer - DBAL) es una capa que se encuentra en la parte superior de <a class="reference external" href="http://www.php.net/pdo">PDO</a> y ofrece una API intuitiva y flexible para comunicarse con las bases de datos relacionales más populares. En otras palabras, la biblioteca DBAL facilita la ejecución de consultas y realización de otras acciones de bases de datos.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Lee la <a href="#id1"><span class="problematic" id="id2">`documentación oficial de DBAL`_</span></a> para conocer todos los detalles y las habilidades de la biblioteca DBAL de Doctrine.</p>
</div>
<p>Para empezar, configura los parámetros de conexión a la base de datos:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">doctrine</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">dbal</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">driver</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">pdo_mysql</span>
        <span class="l-Scalar-Plain">dbname</span><span class="p-Indicator">:</span>   <span class="l-Scalar-Plain">Symfony2</span>
        <span class="l-Scalar-Plain">user</span><span class="p-Indicator">:</span>     <span class="l-Scalar-Plain">root</span>
        <span class="l-Scalar-Plain">password</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">null</span>
        <span class="l-Scalar-Plain">charset</span><span class="p-Indicator">:</span>  <span class="l-Scalar-Plain">UTF8</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre>// app/config/config.xml
<span class="nt">&lt;doctrine:config&gt;</span>
    <span class="nt">&lt;doctrine:dbal</span>
        <span class="na">name=</span><span class="s">&quot;default&quot;</span>
        <span class="na">dbname=</span><span class="s">&quot;Symfony2&quot;</span>
        <span class="na">user=</span><span class="s">&quot;root&quot;</span>
        <span class="na">password=</span><span class="s">&quot;null&quot;</span>
        <span class="na">driver=</span><span class="s">&quot;pdo_mysql&quot;</span>
    <span class="nt">/&gt;</span>
<span class="nt">&lt;/doctrine:config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// app/config/config.php</span>
<span class="x">$contenedor-&gt;loadFromExtension(&#39;doctrine&#39;, array(</span>
<span class="x">    &#39;dbal&#39; =&gt; array(</span>
<span class="x">        &#39;driver&#39;    =&gt; &#39;pdo_mysql&#39;,</span>
<span class="x">        &#39;dbname&#39;    =&gt; &#39;Symfony2&#39;,</span>
<span class="x">        &#39;user&#39;      =&gt; &#39;root&#39;,</span>
<span class="x">        &#39;password&#39;  =&gt; null,</span>
<span class="x">    ),</span>
<span class="x">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Para ver todas las opciones de configuración DBAL, consulta <a class="reference internal" href="../../reference/configuration/doctrine.html#reference-dbal-configuration"><em>Configurando DBAL Doctrine</em></a>.</p>
<p>A continuación, puedes acceder a la conexión Doctrine DBAL accediendo al servicio <tt class="docutils literal"><span class="pre">database_connection</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">class UserController extends Controller</span>
<span class="x">{</span>
<span class="x">    public function indexAction()</span>
<span class="x">    {</span>
<span class="x">        $conn = $this-&gt;get(&#39;database_connection&#39;);</span>
<span class="x">        $usuarios = $conn-&gt;fetchAll(&#39;SELECT * FROM users&#39;);</span>

<span class="x">        // ...</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
<div class="section" id="registrando-tipos-de-asignacion-personalizados">
<h2>Registrando tipos de asignación personalizados<a class="headerlink" href="#registrando-tipos-de-asignacion-personalizados" title="Permalink to this headline">¶</a></h2>
<p>Puedes registrar tipos de asignación personalizados a través de la configuración de Symfony. Ellos se sumarán a todas las conexiones configuradas. Para más información sobre los tipos de asignación personalizados, lee la sección <a class="reference external" href="http://www.doctrine-project.org/docs/dbal/2.0/en/reference/types.html#custom-mapping-types">Tipos de asignación personalizados</a> de la documentación de Doctrine.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">doctrine</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">dbal</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">types</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">custom_first</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\HolaBundle\Type\CustomFirst</span>
            <span class="l-Scalar-Plain">custom_second</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Acme\HolaBundle\Type\CustomSecond</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:doctrine=</span><span class="s">&quot;http://symfony.com/schema/dic/doctrine&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">                        http://symfony.com/schema/dic/doctrine http://symfony.com/schema/dic/doctrine/doctrine-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;doctrine:config&gt;</span>
        <span class="nt">&lt;doctrine:dbal&gt;</span>
        <span class="nt">&lt;doctrine:dbal</span> <span class="na">default-connection=</span><span class="s">&quot;default&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;doctrine:connection&gt;</span>
                <span class="nt">&lt;doctrine:mapping-type</span> <span class="na">name=</span><span class="s">&quot;enum&quot;</span><span class="nt">&gt;</span>string<span class="nt">&lt;/doctrine:mapping-type&gt;</span>
            <span class="nt">&lt;/doctrine:connection&gt;</span>
        <span class="nt">&lt;/doctrine:dbal&gt;</span>
    <span class="nt">&lt;/doctrine:config&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// app/config/config.php</span>
<span class="x">$contenedor-&gt;loadFromExtension(&#39;doctrine&#39;, array(</span>
<span class="x">    &#39;dbal&#39; =&gt; array(</span>
<span class="x">        &#39;connections&#39; =&gt; array(</span>
<span class="x">            &#39;default&#39; =&gt; array(</span>
<span class="x">                &#39;mapping_types&#39; =&gt; array(</span>
<span class="x">                    &#39;enum&#39;  =&gt; &#39;string&#39;,</span>
<span class="x">                ),</span>
<span class="x">            ),</span>
<span class="x">        ),</span>
<span class="x">    ),</span>
<span class="x">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="registrando-tipos-de-asignacion-personalizados-en-schematool">
<h2>Registrando tipos de asignación personalizados en SchemaTool<a class="headerlink" href="#registrando-tipos-de-asignacion-personalizados-en-schematool" title="Permalink to this headline">¶</a></h2>
<p>La SchemaTool se utiliza al inspeccionar la base de datos para comparar el esquema. Para lograr esta tarea, es necesario saber qué tipo de asignación se debe utilizar para cada tipo de la base de datos. Por medio de la configuración puedes registrar nuevos tipos.</p>
<p>Vamos a asignar el tipo ENUM (no apoyado por DBAL de manera predeterminada) al tipo <tt class="docutils literal"><span class="pre">string</span></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">doctrine</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">dbal</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">connection</span><span class="p-Indicator">:</span>
            <span class="l-Scalar-Plain">default</span><span class="p-Indicator">:</span>
                <span class="l-Scalar-Plain">// otros parámetros de conexión</span>
                <span class="l-Scalar-Plain">mapping_types</span><span class="p-Indicator">:</span>
                    <span class="l-Scalar-Plain">enum</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">string</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;container</span> <span class="na">xmlns=</span><span class="s">&quot;http://symfony.com/schema/dic/services&quot;</span>
    <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
    <span class="na">xmlns:doctrine=</span><span class="s">&quot;http://symfony.com/schema/dic/doctrine&quot;</span>
    <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://symfony.com/schema/dic/services http://symfony.com/schema/dic/services/services-1.0.xsd</span>
<span class="s">                        http://symfony.com/schema/dic/doctrine http://symfony.com/schema/dic/doctrine/doctrine-1.0.xsd&quot;</span><span class="nt">&gt;</span>

    <span class="nt">&lt;doctrine:config&gt;</span>
        <span class="nt">&lt;doctrine:dbal&gt;</span>
            <span class="nt">&lt;doctrine:type</span> <span class="na">name=</span><span class="s">&quot;custom_first&quot;</span> <span class="na">class=</span><span class="s">&quot;Acme\HolaBundle\Type\CustomFirst&quot;</span> <span class="nt">/&gt;</span>
            <span class="nt">&lt;doctrine:type</span> <span class="na">name=</span><span class="s">&quot;custom_second&quot;</span> <span class="na">class=</span><span class="s">&quot;Acme\HolaBundle\Type\CustomSecond&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;/doctrine:dbal&gt;</span>
    <span class="nt">&lt;/doctrine:config&gt;</span>
<span class="nt">&lt;/container&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// app/config/config.php</span>
<span class="x">$contenedor-&gt;loadFromExtension(&#39;doctrine&#39;, array(</span>
<span class="x">    &#39;dbal&#39; =&gt; array(</span>
<span class="x">        &#39;types&#39; =&gt; array(</span>
<span class="x">            &#39;custom_first&#39;  =&gt; &#39;Acme\HolaBundle\Type\CustomFirst&#39;,</span>
<span class="x">            &#39;custom_second&#39; =&gt; &#39;Acme\HolaBundle\Type\CustomSecond&#39;,</span>
<span class="x">        ),</span>
<span class="x">    ),</span>
<span class="x">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cómo utiliza Doctrine la capa DBAL</a><ul>
<li><a class="reference internal" href="#registrando-tipos-de-asignacion-personalizados">Registrando tipos de asignación personalizados</a></li>
<li><a class="reference internal" href="#registrando-tipos-de-asignacion-personalizados-en-schematool">Registrando tipos de asignación personalizados en SchemaTool</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="reverse_engineering.html"
                        title="previous chapter">Cómo generar entidades de una base de datos existente</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="multiple_entity_managers.html"
                        title="next chapter">Cómo trabajar con varios administradores de entidad</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/cookbook/doctrine/dbal.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="multiple_entity_managers.html" title="Cómo trabajar con varios administradores de entidad"
             >next</a> |</li>
        <li class="right" >
          <a href="reverse_engineering.html" title="Cómo generar entidades de una base de datos existente"
             >previous</a> |</li>
        <li><a href="../../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Recetario</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Osukaru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>