

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Cómo crear una restricción de validación personalizada &mdash; symfony-docs-es v1 documentation</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="symfony-docs-es v1 documentation" href="../../index.html" />
    <link rel="up" title="Recetario" href="../index.html" />
    <link rel="next" title="Cómo dominar y crear nuevos entornos" href="../configuration/environments.html" />
    <link rel="prev" title="Cómo crear un tipo de campo de formulario personalizado" href="../form/create_custom_field_type.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../configuration/environments.html" title="Cómo dominar y crear nuevos entornos"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../form/create_custom_field_type.html" title="Cómo crear un tipo de campo de formulario personalizado"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Recetario</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="como-crear-una-restriccion-de-validacion-personalizada">
<span id="index-0"></span><h1>Cómo crear una restricción de validación personalizada<a class="headerlink" href="#como-crear-una-restriccion-de-validacion-personalizada" title="Permalink to this headline">¶</a></h1>
<p>Puedes crear una restricción personalizada extendiendo de la clase base &#8220;constraint&#8221;, <tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\Validator\Constraint</span></tt>. Las opciones para tu restricción se representan como propiedades públicas de la clase &#8216;constraint&#8217;. Por ejemplo, la restricción <a class="reference internal" href="../../reference/constraints/Url.html"><em>URL</em></a> incluye las propiedades <tt class="docutils literal"><span class="pre">message</span></tt> y <tt class="docutils literal"><span class="pre">protocols</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">namespace Symfony\Component\Validator\Constraints;</span>

<span class="x">class Url extends \Symfony\Component\Validator\Constraint</span>
<span class="x">{</span>
<span class="x">    public $message = &#39;This value is not a valid URL&#39;;</span>
<span class="x">    public $protocols = array(&#39;http&#39;, &#39;https&#39;, &#39;ftp&#39;, &#39;ftps&#39;);</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Como puedes ver, una clase de restricción es bastante mínima. La validación real la realiza otra clase &#8220;validador de restricción&#8221;. La clase validador de restricción se especifica por el método de la restricción <tt class="docutils literal"><span class="pre">validatedBy()</span></tt>, que por omisión incluye alguna lógica simple:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">// en la clase base Symfony\Component\Validator\Constraint</span>
<span class="x">public function validatedBy()</span>
<span class="x">{</span>
<span class="x">    return get_class($this).&#39;Validator&#39;;</span>
<span class="x">}</span>
</pre></div>
</div>
<p>En otras palabras, si creas una <tt class="docutils literal"><span class="pre">restricción</span></tt> personalizada (por ejemplo, <tt class="docutils literal"><span class="pre">MyConstraint</span></tt>), Symfony2 automáticamente buscará otra clase, <tt class="docutils literal"><span class="pre">MyConstraintValidator</span></tt> cuando realmente lleva a cabo la validación.</p>
<p>La clase &#8220;validator&#8221; también es simple, y sólo tiene un método requerido: <tt class="docutils literal"><span class="pre">isValid</span></tt>.
Tomemos al <tt class="docutils literal"><span class="pre">NotBlankValidator</span></tt> como ejemplo:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">class NotBlankValidator extends ConstraintValidator</span>
<span class="x">{</span>
<span class="x">    public function isValid($value, Constraint $constraint)</span>
<span class="x">    {</span>
<span class="x">        if (null === $value || &#39;&#39; === $value) {</span>
<span class="x">            $this-&gt;setMessage($constraint-&gt;message);</span>

<span class="x">            return false;</span>
<span class="x">        }</span>

<span class="x">        return true;</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
<div class="section" id="restriccion-de-validadores-con-dependencias">
<h2>Restricción de validadores con dependencias<a class="headerlink" href="#restriccion-de-validadores-con-dependencias" title="Permalink to this headline">¶</a></h2>
<p>Si la restricción del validador tiene dependencias, tal como una conexión de base de datos, se tendrá que configurar como un servicio en el contenedor de inyección de dependencias. Este servicio debe incluir la etiqueta <tt class="docutils literal"><span class="pre">validator.constraint_validator</span></tt> y un atributo <tt class="docutils literal"><span class="pre">alias</span></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="l-Scalar-Plain">services</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">validator.unique.your_validator_name</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">class</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">Fully\Qualified\Validator\Class\Name</span>
        <span class="l-Scalar-Plain">tags</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="p-Indicator">{</span> <span class="nv">name</span><span class="p-Indicator">:</span> <span class="nv">validator.constraint_validator</span><span class="p-Indicator">,</span> <span class="nv">alias</span><span class="p-Indicator">:</span> <span class="nv">alias_name</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="nt">&lt;service</span> <span class="na">id=</span><span class="s">&quot;validator.unique.your_validator_name&quot;</span> <span class="na">class=</span><span class="s">&quot;Fully\Qualified\Validator\Class\Name&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;argument</span> <span class="na">type=</span><span class="s">&quot;service&quot;</span> <span class="na">id=</span><span class="s">&quot;doctrine.orm.default_entity_manager&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;tag</span> <span class="na">name=</span><span class="s">&quot;validator.constraint_validator&quot;</span> <span class="na">alias=</span><span class="s">&quot;alias_name&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/service&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">$contenedor</span>
<span class="x">    -&gt;register(&#39;validator.unique.your_validator_name&#39;, &#39;Fully\Qualified\Validator\Class\Name&#39;)</span>
<span class="x">    -&gt;addTag(&#39;validator.constraint_validator&#39;, array(&#39;alias&#39; =&gt; &#39;alias_name&#39;))</span>
<span class="x">;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Tu clase de restricción ahora podrá utilizar este alias para referirse al validador correspondiente:</p>
<div class="highlight-python"><pre>public function validatedBy()
{
    return 'alias_name';
}</pre>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Cómo crear una restricción de validación personalizada</a><ul>
<li><a class="reference internal" href="#restriccion-de-validadores-con-dependencias">Restricción de validadores con dependencias</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../form/create_custom_field_type.html"
                        title="previous chapter">Cómo crear un tipo de campo de formulario personalizado</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../configuration/environments.html"
                        title="next chapter">Cómo dominar y crear nuevos entornos</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/cookbook/validation/custom_constraint.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../configuration/environments.html" title="Cómo dominar y crear nuevos entornos"
             >next</a> |</li>
        <li class="right" >
          <a href="../form/create_custom_field_type.html" title="Cómo crear un tipo de campo de formulario personalizado"
             >previous</a> |</li>
        <li><a href="../../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="../index.html" >Recetario</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Osukaru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>