

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Validando &mdash; symfony-docs-es v1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="symfony-docs-es v1 documentation" href="../index.html" />
    <link rel="up" title="Libro" href="index.html" />
    <link rel="next" title="Formularios" href="forms.html" />
    <link rel="prev" title="Probando" href="testing.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="forms.html" title="Formularios"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Probando"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Libro</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="validando">
<span id="index-0"></span><h1>Validando<a class="headerlink" href="#validando" title="Permalink to this headline">¶</a></h1>
<p>La validación es una tarea muy común en aplicaciones web. Los datos introducidos en formularios se tienen que validar. Los datos también se deben validar antes de escribirlos en una base de datos o pasarlos a un servicio web.</p>
<p>Symfony2 viene con un componente <a class="reference external" href="https://github.com/symfony/Validator">Validator</a> que facilita esta tarea transparentemente.
Este componente está basado en la <a class="reference external" href="http://jcp.org/en/jsr/detail?id=303">especificación JSR303 Bean Validation</a>. ¿Qué?
¿Una especificación de Java en PHP? Has oído bien, pero no es tan malo como suena.
Vamos a ver cómo se puede utilizar en PHP.</p>
<div class="section" id="fundamentos-de-la-validacion">
<h2>Fundamentos de la validación<a class="headerlink" href="#fundamentos-de-la-validacion" title="Permalink to this headline">¶</a></h2>
<p>La mejor manera de entender la validación es verla en acción. Para empezar, supongamos que hemos creado un objeto plano en PHP el cual en algún lugar tiene que utilizar tu aplicación:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Acme/BlogBundle/Entity/Autor.php</span>
<span class="x">namespace Acme\BlogBundle\Entity;</span>

<span class="x">class Autor</span>
<span class="x">{</span>
<span class="x">    public $nombre;</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Hasta ahora, esto es sólo una clase ordinaria que sirve a algún propósito dentro de tu aplicación. El objetivo de la validación es decir si o no los datos de un objeto son válidos. Para que esto funcione, debes configurar una lista de reglas (llamada <a class="reference internal" href="#validation-constraints"><em>constraints -restricciones</em></a>) que el objeto debe seguir para ser válido. Estas reglas se pueden especificar a través de una serie de formatos diferentes (YAML, XML, anotaciones o PHP).</p>
<p>Por ejemplo, para garantizar que la propiedad <tt class="docutils literal"><span class="pre">$nombre</span></tt> no esté vacía, agrega lo siguiente:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Autor</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">nombre</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NotBlank</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Autor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;nombre&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotBlank&quot;</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><pre>// src/Acme/BlogBundle/Entity/Autor.php
use Symfony\Component\Validator\Constraints as Assert;

class Autor
{
    /**
     * @Assert\NotBlank()
     */
    public $nombre;
}</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Acme/BlogBundle/Entity/Autor.php</span>

<span class="x">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span class="x">use Symfony\Component\Validator\Constraints\NotBlank;</span>

<span class="x">class Autor</span>
<span class="x">{</span>
<span class="x">    public $nombre;</span>

<span class="x">    public static function loadValidatorMetadata(ClassMetadata $metadatos)</span>
<span class="x">    {</span>
<span class="x">        $metadatos-&gt;addPropertyConstraint(&#39;nombre&#39;, new NotBlank());</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Las propiedades protegidas y privadas también se pueden validar, así como los métodos &#8220;get&#8221; (consulta la sección <a class="reference internal" href="#validator-constraint-targets"><em>Objetivos de restricción</em></a>).</p>
</div>
<div class="section" id="usando-el-servicio-validador">
<span id="index-1"></span><h3>Usando el servicio <tt class="docutils literal"><span class="pre">validador</span></tt><a class="headerlink" href="#usando-el-servicio-validador" title="Permalink to this headline">¶</a></h3>
<p>A continuación, para validar realmente un objeto <tt class="docutils literal"><span class="pre">Autor</span></tt>, utiliza el método <tt class="docutils literal"><span class="pre">validate</span></tt> del servicio <tt class="docutils literal"><span class="pre">validador</span></tt> (clase <tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\Validator\Validator</span></tt>).
El trabajo del <tt class="docutils literal"><span class="pre">validador</span></tt> es fácil: lee las restricciones (es decir, las reglas) de una clase y comprueba si los datos en el objeto satisfacen esas restricciones. Si la validación falla, devuelve un arreglo de errores. Toma este sencillo ejemplo desde el interior de un controlador:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">use Symfony\Component\HttpFoundation\Response;</span>
<span class="x">use Acme\BlogBundle\Entity\Autor;</span>
<span class="x">// ...</span>

<span class="x">public function indexAction()</span>
<span class="x">{</span>
<span class="x">    $autor = new Autor();</span>
<span class="x">    // ... haz algo con el objeto $autor</span>

<span class="x">    $validador = $this-&gt;get(&#39;validator&#39;);</span>
<span class="x">    $listaErrores = $validador-&gt;validate($autor);</span>

<span class="x">    if (count($listaErrores) &gt; 0) {</span>
<span class="x">        return new Response(print_r($listaErrores, true));</span>
<span class="x">    } else {</span>
<span class="x">        return new Response(&#39;¡El autor es válido! ¡Sí!&#39;);</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Si la propiedad <tt class="docutils literal"><span class="pre">$nombre</span></tt> está vacía, verás el siguiente mensaje de error:</p>
<div class="highlight-text"><div class="highlight"><pre>Acme\BlogBundle\Autor.nombre:
    Este valor no debe estar en blanco
</pre></div>
</div>
<p>Si insertas un valor en la propiedad <tt class="docutils literal"><span class="pre">nombre</span></tt>, aparecerá el satisfactorio mensaje de éxito.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">La mayor parte del tiempo, no interactúas directamente con el servicio <tt class="docutils literal"><span class="pre">validador</span></tt> o necesitas preocuparte por imprimir los errores. La mayoría de las veces, vas a utilizar la validación indirectamente al manejar los datos de formularios presentados. Para más información, consulta la sección <a class="reference internal" href="#book-validation-forms"><em>Validación y formularios</em></a>.</p>
</div>
<p>También puedes pasar la colección de errores a una plantilla.</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">if (count($listaErrores) &gt; 0) {</span>
<span class="x">    return $this-&gt;render(&#39;AcmeBlogBundle:Autor:validate.html.twig&#39;, array(</span>
<span class="x">        &#39;listaErrores&#39; =&gt; $listaErrores,</span>
<span class="x">    ));</span>
<span class="x">} else {</span>
<span class="x">    // ...</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Dentro de la plantilla, puedes sacar la lista de errores exactamente como la necesites:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>Twig</em><div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# src/Acme/BlogBundle/Resources/views/Autor/validate.html.twig #}</span>

<span class="nt">&lt;h3&gt;</span>El autor tiene los siguientes errores<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">error</span> <span class="k">in</span> <span class="nv">listaErrores</span> <span class="cp">%}</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">{{</span> <span class="nv">error.message</span> <span class="cp">}}</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/views/Autor/validate.html.php --&gt;</span>

<span class="nt">&lt;h3&gt;</span>El autor tiene los siguientes errores<span class="nt">&lt;/h3&gt;</span>
<span class="nt">&lt;ul&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$listaErrores</span> <span class="k">as</span> <span class="nv">$error</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;li&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$error</span><span class="o">-&gt;</span><span class="na">getMessage</span><span class="p">()</span> <span class="cp">?&gt;</span><span class="nt">&lt;/li&gt;</span>
<span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
</li>
</ul>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Cada error de validación (conocido cómo &#8220;violación de restricción&#8221;), está representado por un objeto <tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\Validator\ConstraintViolation</span></tt>.</p>
</div>
</div>
<div class="section" id="validacion-y-formularios">
<span id="book-validation-forms"></span><span id="index-2"></span><h3>Validación y formularios<a class="headerlink" href="#validacion-y-formularios" title="Permalink to this headline">¶</a></h3>
<p>Puedes utilizar el servicio <tt class="docutils literal"><span class="pre">validator</span></tt> en cualquier momento para validar cualquier objeto.
En realidad, sin embargo, por lo general al trabajar con formularios vas a trabajar con el <tt class="docutils literal"><span class="pre">validador</span></tt> indirectamente. La biblioteca de formularios de Symfony utiliza internamente el servicio <tt class="docutils literal"><span class="pre">validador</span></tt> para validar el objeto subyacente después de que los valores se han presentado y vinculado. Las violaciones de restricción en el objeto se convierten en objetos <tt class="docutils literal"><span class="pre">FieldError</span></tt> los cuales puedes mostrar fácilmente en tu formulario. El flujo de trabajo típico en la presentación del formulario se parece a lo siguiente visto desde el interior de un controlador:</p>
<div class="highlight-python"><pre>use Acme\BlogBundle\Entity\Autor;
use Acme\BlogBundle\Form\AutorType;
use Symfony\Component\HttpFoundation\Request;
// ...

public function updateAction(Request $peticion)
{
    $autor = new Acme\BlogBundle\Entity\Autor();
    $formulario = $this-&gt;createForm(new AutorType(), $autor);

    if ($peticion-&gt;getMethod() == 'POST') {
        $formulario-&gt;bindRequest($peticion);

        if ($formulario-&gt;isValid()) {
            // pasó la validación, haz algo con el objeto $autor

            $this-&gt;redirect($this-&gt;generateUrl('...'));
        }
    }

    return $this-&gt;render('BlogBundle:Autor:form.html.twig', array(
        'form' =&gt; $formulario-&gt;createView(),
    ));
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Este ejemplo utiliza un formulario de la clase <tt class="docutils literal"><span class="pre">AutorType</span></tt>, el cual no mostramos aquí.</p>
</div>
<p>Para más información, consulta el capítulo <a class="reference internal" href="forms.html"><em>Formularios</em></a>.</p>
</div>
</div>
<div class="section" id="configurando">
<span id="book-validation-configuration"></span><span id="index-3"></span><h2>Configurando<a class="headerlink" href="#configurando" title="Permalink to this headline">¶</a></h2>
<p>El validador de Symfony2 está activado por omisión, pero debes habilitar explícitamente las anotaciones si estás utilizando el método de anotación para especificar tus restricciones:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># app/config/config.yml</span>
<span class="l-Scalar-Plain">framework</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">validation</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">enable_annotations</span><span class="p-Indicator">:</span> <span class="nv">true</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- app/config/config.xml --&gt;</span>
<span class="nt">&lt;framework:config&gt;</span>
    <span class="nt">&lt;framework:validation</span> <span class="na">enable_annotations=</span><span class="s">&quot;true&quot;</span> <span class="nt">/&gt;</span>
<span class="nt">&lt;/framework:config&gt;</span>
</pre></div>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// app/config/config.php</span>
<span class="x">$contenedor-&gt;loadFromExtension(&#39;framework&#39;, array(&#39;validation&#39; =&gt; array(</span>
<span class="x">    &#39;enable_annotations&#39; =&gt; true,</span>
<span class="x">));</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="restricciones">
<span id="validation-constraints"></span><span id="index-4"></span><h2>Restricciones<a class="headerlink" href="#restricciones" title="Permalink to this headline">¶</a></h2>
<p>El <tt class="docutils literal"><span class="pre">validador</span></tt> está diseñado para validar objetos contra <em>restricciones</em> (es decir, reglas). A fin de validar un objeto, basta con asignar una o más restricciones a tu clase y luego pasarla al servicio <tt class="docutils literal"><span class="pre">validador</span></tt>.</p>
<p>Detrás del escenario, una restricción es simplemente un objeto PHP que hace una declaración afirmativa. En la vida real, una restricción podría ser: &#8220;El pastel no se debe quemar&#8221;.
En Symfony2, las restricciones son similares: son aserciones de que una condición es verdadera. Dado un valor, una restricción te dirá si o no el valor se adhiere a las reglas de tu restricción.</p>
<div class="section" id="restricciones-compatibles">
<h3>Restricciones compatibles<a class="headerlink" href="#restricciones-compatibles" title="Permalink to this headline">¶</a></h3>
<p>Symfony2 viene con un gran número de las más comunes restricciones necesarias.
La lista completa de restricciones con detalles está disponible en la <a class="reference internal" href="../reference/constraints.html"><em>sección referencia de restricciones</em></a>.</p>
</div>
<div class="section" id="configurando-restricciones">
<span id="book-validation-constraint-configuration"></span><span id="index-5"></span><h3>Configurando restricciones<a class="headerlink" href="#configurando-restricciones" title="Permalink to this headline">¶</a></h3>
<p>Algunas restricciones, como <a class="reference internal" href="../reference/constraints/NotBlank.html"><em>NotBlank</em></a>, son simples, mientras que otras, como la restricción <a class="reference internal" href="../reference/constraints/Choice.html"><em>Choice</em></a>, tienen varias opciones de configuración disponibles. Supongamos que la clase <tt class="docutils literal"><span class="pre">Autor</span></tt> tiene otra propiedad, <tt class="docutils literal"><span class="pre">género</span></tt> que se puede configurar como &#8220;masculino&#8221; o &#8220;femenino&#8221;:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Autor</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">genero</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Choice</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">choices</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">masculino</span><span class="p-Indicator">,</span> <span class="nv">femenino</span><span class="p-Indicator">],</span> <span class="nv">message</span><span class="p-Indicator">:</span> <span class="nv">Elige un género válido.</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Autor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;genero&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;Choice&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;choices&quot;</span><span class="nt">&gt;</span>
                <span class="nt">&lt;value&gt;</span>masculino<span class="nt">&lt;/value&gt;</span>
                <span class="nt">&lt;value&gt;</span>femenino<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;/option&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>Elige un género válido.<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><pre>// src/Acme/BlogBundle/Entity/Autor.php
use Symfony\Component\Validator\Constraints as Assert;

class Autor
{
    /**
     * @Assert\Choice(
     *     choices = { "masculino", "femenino" },
     *     message = "Elige un género válido."
     * )
     */
    public $genero;
}</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Acme/BlogBundle/Entity/Autor.php</span>
<span class="x">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span class="x">use Symfony\Component\Validator\Constraints\NotBlank;</span>

<span class="x">class Autor</span>
<span class="x">{</span>
<span class="x">    public $genero;</span>

<span class="x">    public static function loadValidatorMetadata(ClassMetadata $metadatos)</span>
<span class="x">    {</span>
<span class="x">        $metadatos-&gt;addPropertyConstraint(&#39;genero&#39;, new Choice(array(</span>
<span class="x">            &#39;choices&#39; =&gt; array(&#39;masculino&#39;, &#39;femenino&#39;),</span>
<span class="x">            &#39;message&#39; =&gt; &#39;Elige un género válido.&#39;,</span>
<span class="x">        ));</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Las opciones de una restricción siempre se pueden pasar como una matriz. Algunas restricciones, sin embargo, también te permiten pasar el valor de una opción &#8220;<em>predeterminada</em>&#8221;, en lugar del arreglo. En el caso de la restricción <tt class="docutils literal"><span class="pre">Choice</span></tt>, las <tt class="docutils literal"><span class="pre">opciones</span></tt> se pueden especificar de esta manera.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Autor</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">genero</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">Choice</span><span class="p-Indicator">:</span> <span class="p-Indicator">[</span><span class="nv">masculino</span><span class="p-Indicator">,</span> <span class="nv">femenino</span><span class="p-Indicator">]</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Autor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;genero&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;Choice&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;value&gt;</span>masculino<span class="nt">&lt;/value&gt;</span>
            <span class="nt">&lt;value&gt;</span>femenino<span class="nt">&lt;/value&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><pre>// src/Acme/BlogBundle/Entity/Autor.php
use Symfony\Component\Validator\Constraints as Assert;

class Autor
{
    /**
     * @Assert\Choice({"masculino", "femenino"})
     */
    protected $genero;
}</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Acme/BlogBundle/Entity/Autor.php</span>
<span class="x">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span class="x">use Symfony\Component\Validator\Constraints\Choice;</span>

<span class="x">class Autor</span>
<span class="x">{</span>
<span class="x">    protected $genero;</span>

<span class="x">    public static function loadValidatorMetadata(ClassMetadata $metadatos)</span>
<span class="x">    {</span>
<span class="x">        $metadatos-&gt;addPropertyConstraint(&#39;genero&#39;, new Choice(array(&#39;masculino&#39;, &#39;femenino&#39;)));</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Esto, simplemente está destinado a hacer que la configuración de las opciones más comunes de una restricción sea más breve y rápida.</p>
<p>Si alguna vez no está seguro de cómo especificar una opción, o bien consulta la documentación de la API por la restricción o juega a lo seguro pasando siempre las opciones en un arreglo (el primer método se muestra más arriba).</p>
</div>
</div>
<div class="section" id="objetivos-de-restriccion">
<span id="validator-constraint-targets"></span><span id="index-6"></span><h2>Objetivos de restricción<a class="headerlink" href="#objetivos-de-restriccion" title="Permalink to this headline">¶</a></h2>
<p>Las restricciones se pueden aplicar a una propiedad de clase (por ejemplo, <tt class="docutils literal"><span class="pre">nombre</span></tt>) o a un método captador público (por ejemplo <tt class="docutils literal"><span class="pre">getNombreCompleto</span></tt>). El primero es el más común y fácil de usar, pero el segundo te permite especificar reglas de validación más complejas.</p>
<div class="section" id="propiedades">
<span id="index-7"></span><h3>Propiedades<a class="headerlink" href="#propiedades" title="Permalink to this headline">¶</a></h3>
<p>La validación de propiedades de clase es la técnica de validación más básica. Symfony2 te permite validar propiedades privadas, protegidas o públicas. El siguiente listado muestra cómo configurar la propiedad <tt class="docutils literal"><span class="pre">$primerNombre</span></tt> de una clase <tt class="docutils literal"><span class="pre">Autor</span></tt> para que por lo menos tenga 3 caracteres.</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Autor</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">properties</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">nombreDePila</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">NotBlank</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">~</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">MinLength</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">3</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Autor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;property</span> <span class="na">name=</span><span class="s">&quot;nombreDePila&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;NotBlank&quot;</span> <span class="nt">/&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;MinLength&quot;</span><span class="nt">&gt;</span>3<span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><pre>// Acme/BlogBundle/Entity/Autor.php
use Symfony\Component\Validator\Constraints as Assert;

class Autor
{
    /**
     * @Assert\NotBlank()
     * @Assert\MinLength(3)
     */
    private $nombreDePila;
}</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Acme/BlogBundle/Entity/Autor.php</span>
<span class="x">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span class="x">use Symfony\Component\Validator\Constraints\NotBlank;</span>
<span class="x">use Symfony\Component\Validator\Constraints\MinLength;</span>

<span class="x">class Autor</span>
<span class="x">{</span>
<span class="x">    private $nombreDePila;</span>

<span class="x">    public static function loadValidatorMetadata(ClassMetadata $metadatos)</span>
<span class="x">    {</span>
<span class="x">        $metadatos-&gt;addPropertyConstraint(&#39;nombreDePila&#39;, new NotBlank());</span>
<span class="x">        $metadatos-&gt;addPropertyConstraint(&#39;nombreDePila&#39;, new MinLength(3));</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="captadores">
<span id="index-8"></span><h3>Captadores<a class="headerlink" href="#captadores" title="Permalink to this headline">¶</a></h3>
<p>Las restricciones también se pueden aplicar al valor devuelto por un método. Symfony2 te permite agregar una restricción a cualquier método público cuyo nombre comience con <tt class="docutils literal"><span class="pre">get</span></tt> o <tt class="docutils literal"><span class="pre">is</span></tt>. En esta guía, ambos métodos de este tipo son conocidos como &#8220;captadores&#8221; o <tt class="docutils literal"><span class="pre">getters</span></tt>.</p>
<p>La ventaja de esta técnica es que te permite validar el objeto de forma dinámica. Por ejemplo, supongamos que quieres asegurarte de que un campo de contraseña no coincide con el nombre del usuario (por razones de seguridad). Puedes hacerlo creando un método <tt class="docutils literal"><span class="pre">isPaseLegal</span></tt>, a continuación, acertar que este método debe devolver <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="configuration-block">
<ul class="simple">
<li><em>YAML</em><div class="highlight-yaml"><div class="highlight"><pre><span class="c1"># src/Acme/BlogBundle/Resources/config/validation.yml</span>
<span class="l-Scalar-Plain">Acme\BlogBundle\Entity\Autor</span><span class="p-Indicator">:</span>
    <span class="l-Scalar-Plain">getters</span><span class="p-Indicator">:</span>
        <span class="l-Scalar-Plain">paseLegal</span><span class="p-Indicator">:</span>
            <span class="p-Indicator">-</span> <span class="l-Scalar-Plain">True</span><span class="p-Indicator">:</span> <span class="p-Indicator">{</span> <span class="nv">message</span><span class="p-Indicator">:</span> <span class="s">&quot;La</span><span class="nv"> </span><span class="s">contraseña</span><span class="nv"> </span><span class="s">no</span><span class="nv"> </span><span class="s">debe</span><span class="nv"> </span><span class="s">coincidir</span><span class="nv"> </span><span class="s">con</span><span class="nv"> </span><span class="s">tu</span><span class="nv"> </span><span class="s">nombre&quot;</span> <span class="p-Indicator">}</span>
</pre></div>
</div>
</li>
<li><em>XML</em><div class="highlight-xml"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/config/validation.xml --&gt;</span>
<span class="nt">&lt;class</span> <span class="na">name=</span><span class="s">&quot;Acme\BlogBundle\Entity\Autor&quot;</span><span class="nt">&gt;</span>
    <span class="nt">&lt;getter</span> <span class="na">property=</span><span class="s">&quot;paseLegal&quot;</span><span class="nt">&gt;</span>
        <span class="nt">&lt;constraint</span> <span class="na">name=</span><span class="s">&quot;True&quot;</span><span class="nt">&gt;</span>
            <span class="nt">&lt;option</span> <span class="na">name=</span><span class="s">&quot;message&quot;</span><span class="nt">&gt;</span>La contraseña no debe coincidir con tu nombre<span class="nt">&lt;/option&gt;</span>
        <span class="nt">&lt;/constraint&gt;</span>
    <span class="nt">&lt;/getter&gt;</span>
<span class="nt">&lt;/class&gt;</span>
</pre></div>
</div>
</li>
<li><em>Annotations</em><div class="highlight-php-annotations"><pre>// src/Acme/BlogBundle/Entity/Autor.php
use Symfony\Component\Validator\Constraints as Assert;

class Autor
{
    /**
     * @Assert\True(message = "La contraseña no debe coincidir con tu nombre")
     */
    public function isPaseLegal()
    {
        // devuelve true o false
    }
}</pre>
</div>
</li>
<li><em>PHP</em><div class="highlight-php"><div class="highlight"><pre><span class="x">// src/Acme/BlogBundle/Entity/Autor.php</span>
<span class="x">use Symfony\Component\Validator\Mapping\ClassMetadata;</span>
<span class="x">use Symfony\Component\Validator\Constraints\True;</span>

<span class="x">class Autor</span>
<span class="x">{</span>
<span class="x">    public static function loadValidatorMetadata(ClassMetadata $metadatos)</span>
<span class="x">    {</span>
<span class="x">        $metadatos-&gt;addGetterConstraint(&#39;paseLegal&#39;, new True(array(</span>
<span class="x">            &#39;message&#39; =&gt; &#39;La contraseña no debe coincidir con tu nombre&#39;,</span>
<span class="x">        )));</span>
<span class="x">    }</span>
<span class="x">}</span>
</pre></div>
</div>
</li>
</ul>
</div>
<p>Ahora, crea el método <tt class="docutils literal"><span class="pre">isPaseLegal()</span></tt> e incluye la lógica que necesites:</p>
<div class="highlight-python"><pre>public function isPaseLegal()
{
    return ($this-&gt;nombreDePila != $this-&gt;password);
}</pre>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">El ojo perspicaz se habrá dado cuenta de que el prefijo del captador (<tt class="docutils literal"><span class="pre">get</span></tt> o <tt class="docutils literal"><span class="pre">is</span></tt>) se omite en la asignación. Esto te permite mover la restricción a una propiedad con el mismo nombre más adelante (o viceversa) sin cambiar la lógica de validación.</p>
</div>
</div>
</div>
<div class="section" id="validando-grupos">
<span id="book-validation-validation-groups"></span><h2>Validando grupos<a class="headerlink" href="#validando-grupos" title="Permalink to this headline">¶</a></h2>
<p>Hasta ahora, hemos sido capaces de agregar restricciones a una clase y consultar si o no esa clase pasa todas las restricciones definidas. En algunos casos, sin embargo, tendrás que validar un objeto sólo contra <em>algunas</em> de las restricciones de esa clase. Para ello, puedes organizar cada restricción en uno o más &#8220;grupos de validación&#8221;, y luego aplicar la validación contra un solo grupo de restricciones.</p>
<p>Por ejemplo, supongamos que tienes una clase <tt class="docutils literal"><span class="pre">usuario</span></tt>, que se usa tanto cuando un usuario se registra como cuando un usuario actualiza su información de contacto más adelante:</p>
<div class="highlight-python"><pre>// src/Acme/BlogBundle/Entity/Usuario.php
namespace Acme\BlogBundle\Entity;

use Symfony\Component\Security\Core\User\UserInterface
use Symfony\Component\Validator\Constraints as Assert;

class Usuario implements UserInterface
{
    /**
    * @Assert\Correo(groups={"alta"})
    */
    private $correo;

    /**
    * @Assert\NotBlank(groups={"alta"})
    * @Assert\MinLength(limit=7, groups={"alta"})
    */
    private $pase;

    /**
    * @Assert\MinLength(2)
    */
    private $ciudad;
}</pre>
</div>
<p>Con esta configuración, hay dos grupos de validación:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">Default</span></tt> - contiene las restricciones no asignadas a ningún otro grupo;</li>
<li><tt class="docutils literal"><span class="pre">alta</span></tt> - contiene restricciones sólo en los campos de <tt class="docutils literal"><span class="pre">correo</span> <span class="pre">electrónico</span></tt> y <tt class="docutils literal"><span class="pre">contraseña</span></tt>.</li>
</ul>
<p>Para decir al validador que use un grupo específico, pasa uno o más nombres de grupo como segundo argumento al método <tt class="docutils literal"><span class="pre">validate()</span></tt>:</p>
<div class="highlight-python"><pre>$listaErrores = $validador-&gt;validate($autor, array('alta'));</pre>
</div>
<p>Por supuesto, por lo general vas a trabajar con la validación indirectamente a través de la biblioteca de formularios. Para obtener información sobre cómo utilizar la validación de grupos dentro de los formularios, consulta <a class="reference internal" href="forms.html#book-forms-validation-groups"><em>Validando grupos</em></a>.</p>
</div>
<div class="section" id="consideraciones-finales">
<h2>Consideraciones finales<a class="headerlink" href="#consideraciones-finales" title="Permalink to this headline">¶</a></h2>
<p>El <tt class="docutils literal"><span class="pre">validador</span></tt> de Symfony2 es una herramienta poderosa que puedes aprovechar para garantizar que los datos de cualquier objeto son &#8220;válidos&#8221;. El poder detrás de la validación radica en las &#8220;restricciones&#8221;, las cuales son reglas que se pueden aplicar a propiedades o métodos captadores de tu objeto. Y mientras más utilices la plataforma de validación indirectamente cuando uses formularios, recordarás que puedes utilizarla en cualquier lugar para validar cualquier objeto.</p>
</div>
<div class="section" id="aprende-mas-en-el-recetario">
<h2>Aprende más en el recetario<a class="headerlink" href="#aprende-mas-en-el-recetario" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/validation/custom_constraint.html"><em>Cómo crear una restricción de validación personalizada</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Validando</a><ul>
<li><a class="reference internal" href="#fundamentos-de-la-validacion">Fundamentos de la validación</a><ul>
<li><a class="reference internal" href="#usando-el-servicio-validador">Usando el servicio <tt class="docutils literal"><span class="pre">validador</span></tt></a></li>
<li><a class="reference internal" href="#validacion-y-formularios">Validación y formularios</a></li>
</ul>
</li>
<li><a class="reference internal" href="#configurando">Configurando</a></li>
<li><a class="reference internal" href="#restricciones">Restricciones</a><ul>
<li><a class="reference internal" href="#restricciones-compatibles">Restricciones compatibles</a></li>
<li><a class="reference internal" href="#configurando-restricciones">Configurando restricciones</a></li>
</ul>
</li>
<li><a class="reference internal" href="#objetivos-de-restriccion">Objetivos de restricción</a><ul>
<li><a class="reference internal" href="#propiedades">Propiedades</a></li>
<li><a class="reference internal" href="#captadores">Captadores</a></li>
</ul>
</li>
<li><a class="reference internal" href="#validando-grupos">Validando grupos</a></li>
<li><a class="reference internal" href="#consideraciones-finales">Consideraciones finales</a></li>
<li><a class="reference internal" href="#aprende-mas-en-el-recetario">Aprende más en el recetario</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="testing.html"
                        title="previous chapter">Probando</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="forms.html"
                        title="next chapter">Formularios</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/validation.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="forms.html" title="Formularios"
             >next</a> |</li>
        <li class="right" >
          <a href="testing.html" title="Probando"
             >previous</a> |</li>
        <li><a href="../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Libro</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Osukaru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>