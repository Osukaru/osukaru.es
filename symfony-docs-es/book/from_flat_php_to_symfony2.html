

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Symfony2 frente a PHP simple &mdash; symfony-docs-es v1 documentation</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="symfony-docs-es v1 documentation" href="../index.html" />
    <link rel="up" title="Libro" href="index.html" />
    <link rel="next" title="Instalando y configurando Symfony" href="installation.html" />
    <link rel="prev" title="Symfony2 y fundamentos HTTP" href="http_fundamentals.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="installation.html" title="Instalando y configurando Symfony"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="http_fundamentals.html" title="Symfony2 y fundamentos HTTP"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="index.html" accesskey="U">Libro</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="symfony2-frente-a-php-simple">
<h1>Symfony2 frente a PHP simple<a class="headerlink" href="#symfony2-frente-a-php-simple" title="Permalink to this headline">¶</a></h1>
<p><strong>¿Por qué Symfony2 es mejor que sólo abrir un archivo y escribir PHP simple?</strong></p>
<p>Si nunca haz usado una plataforma PHP, no estás familiarizado con la filosofía MVC, o simplemente te preguntas qué es todo ese <em>alboroto</em> en torno a Symfony2, este capítulo es para ti. En vez de <em>decirte</em> que Symfony2 te permite desarrollar software más rápido y mejor que con PHP simple, debes verlo tú mismo.</p>
<p>En este capítulo, vamos a escribir una aplicación sencilla en PHP simple, y luego la reconstruiremos para que esté mejor organizada. Podrás viajar a través del tiempo, viendo las decisiones de por qué el desarrollo web ha evolucionado en los últimos años hasta donde está ahora.</p>
<p>Al final, verás cómo Symfony2 te puede rescatar de las tareas cotidianas y te permite recuperar el control de tu código.</p>
<div class="section" id="un-sencillo-blog-en-php-simple">
<h2>Un sencillo blog en PHP simple<a class="headerlink" href="#un-sencillo-blog-en-php-simple" title="Permalink to this headline">¶</a></h2>
<p>En este capítulo, crearemos una simbólica aplicación de blog utilizando sólo PHP simple.
Para empezar, crea una página que muestra las entradas del blog que se han persistido en la base de datos. Escribirla en PHP simple es rápido y sucio:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="nv">$enlace</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;miusuario&#39;</span><span class="p">,</span> <span class="s1">&#39;mipase&#39;</span><span class="p">);</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;bd_blog&#39;</span><span class="p">,</span> <span class="nv">$enlace</span><span class="p">);</span>

<span class="nv">$resultado</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, titulo FROM post&#39;</span><span class="p">,</span> <span class="nv">$enlace</span><span class="p">);</span>
<span class="cp">?&gt;</span>

<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Lista de mensajes<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Lista de mensajes<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">while</span> <span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">))</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/show.php?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$fila</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$fila</span><span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">endwhile</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>

<span class="cp">&lt;?php</span>
<span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$enlace</span><span class="p">);</span>
</pre></div>
</div>
<p>Eso es fácil de escribir, se ejecuta rápido, y, cuando tu aplicación crece, imposible de mantener. Hay varios problemas que es necesario abordar:</p>
<ul class="simple">
<li><strong>No hay comprobación de errores</strong>: ¿Qué sucede si falla la conexión a la base de datos?</li>
<li><strong>Deficiente organización</strong>: Si la aplicación crece, este único archivo cada vez será más difícil de mantener, hasta que finalmente sea imposible. ¿Dónde se debe colocar el código para manejar un formulario enviado? ¿Cómo se pueden validar los datos? ¿Dónde debe ir el código para enviar mensajes de correo electrónico?</li>
<li><strong>Es difícil reutilizar el código</strong>: Ya que todo está en un archivo, no hay manera de volver a utilizar alguna parte de la aplicación en otras &#8220;páginas&#8221; del blog.</li>
</ul>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Otro problema no mencionado aquí es el hecho de que la base de datos está vinculada a MySQL. Aunque no se ha tratado aquí, Symfony2 integra <a class="reference external" href="http://www.doctrine-project.org">Doctrine</a> plenamente, una biblioteca dedicada a la abstracción y asignación de bases de datos.</p>
</div>
<p>Vamos a trabajar en la solución de estos y muchos problemas más.</p>
<div class="section" id="aislando-la-presentacion">
<h3>Aislando la presentación<a class="headerlink" href="#aislando-la-presentacion" title="Permalink to this headline">¶</a></h3>
<p>El código inmediatamente se puede beneficiar de la separación entre la &#8220;lógica&#8221; de la aplicación y el código que prepara la &#8220;presentación&#8221; HTML:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="nv">$enlace</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;miusuario&#39;</span><span class="p">,</span> <span class="s1">&#39;mipase&#39;</span><span class="p">);</span>
<span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;bd_blog&#39;</span><span class="p">,</span> <span class="nv">$enlace</span><span class="p">);</span>

<span class="nv">$resultado</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, titulo FROM post&#39;</span><span class="p">,</span> <span class="nv">$enlace</span><span class="p">);</span>

<span class="nv">$mensajes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
<span class="k">while</span> <span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$mensajes</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$fila</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$enlace</span><span class="p">);</span>

<span class="c1">// incluye el código HTML de la presentación</span>
<span class="k">require</span> <span class="s1">&#39;plantillas/lista.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Ahora el código HTML está guardado en un archivo separado (<tt class="docutils literal"><span class="pre">plantillas/lista.php</span></tt>), el cual principalmente es un archivo HTML que utiliza una sintaxis de plantilla tipo PHP:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span>Lista de mensajes<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="nt">&lt;h1&gt;</span>Lista de mensajes<span class="nt">&lt;/h1&gt;</span>
        <span class="nt">&lt;ul&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mensajes</span> <span class="k">as</span> <span class="nv">$mensaje</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;li&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/leer?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                    <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/li&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/ul&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Por convención, el archivo que contiene toda la lógica de la aplicación - <tt class="docutils literal"><span class="pre">index.php</span></tt> - se conoce como <em>&#8220;controlador&#8221;</em>. El término <a class="reference internal" href="../glossary.html#term-controlador"><em class="xref std std-term">controlador</em></a> es una palabra que se escucha mucho, independientemente del lenguaje o plataforma que utilices. Simplemente se refiere a la zona de <em>tu código</em> que procesa la entrada del usuario y prepara la respuesta.</p>
<p>En este caso, nuestro controlador prepara los datos de la base de datos y, luego los incluye en una plantilla para presentarlos. Con el controlador aislado, fácilmente podríamos cambiar <em>sólo</em> el archivo de plantilla si es necesario procesar las entradas de blog en algún otro formato (por ejemplo, <tt class="docutils literal"><span class="pre">lista.json.php</span></tt> para el formato JSON).</p>
</div>
<div class="section" id="aislando-la-logica-de-la-aplicacion-el-dominio">
<h3>Aislando la lógica de la aplicación (el dominio)<a class="headerlink" href="#aislando-la-logica-de-la-aplicacion-el-dominio" title="Permalink to this headline">¶</a></h3>
<p>Hasta ahora, la aplicación sólo contiene una página. Pero ¿qué pasa si una segunda página necesita utilizar la misma conexión a la base de datos, e incluso la misma matriz de entradas del blog? Reconstruye el código para que el comportamiento de las funciones básicas de acceso a datos de la aplicación esté aislado en un nuevo archivo llamado <tt class="docutils literal"><span class="pre">modelo.php</span></tt>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// modelo.php</span>

<span class="k">function</span> <span class="nf">abre_conexion_bd</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$enlace</span> <span class="o">=</span> <span class="nb">mysql_connect</span><span class="p">(</span><span class="s1">&#39;localhost&#39;</span><span class="p">,</span> <span class="s1">&#39;miusuario&#39;</span><span class="p">,</span> <span class="s1">&#39;mipase&#39;</span><span class="p">);</span>
    <span class="nb">mysql_select_db</span><span class="p">(</span><span class="s1">&#39;bd_blog&#39;</span><span class="p">,</span> <span class="nv">$enlace</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$enlace</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">cierra_conexion_bd</span><span class="p">(</span><span class="nv">$enlace</span><span class="p">)</span>
<span class="p">{</span>
    <span class="nb">mysql_close</span><span class="p">(</span><span class="nv">$enlace</span><span class="p">);</span>
<span class="p">}</span>

<span class="k">function</span> <span class="nf">obt_todo_mensaje</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nv">$enlace</span> <span class="o">=</span> <span class="nx">abre_conexion_bd</span><span class="p">();</span>

    <span class="nv">$resultado</span> <span class="o">=</span> <span class="nb">mysql_query</span><span class="p">(</span><span class="s1">&#39;SELECT id, titulo FROM post&#39;</span><span class="p">,</span> <span class="nv">$enlace</span><span class="p">);</span>
    <span class="nv">$mensajes</span> <span class="o">=</span> <span class="k">array</span><span class="p">();</span>
    <span class="k">while</span> <span class="p">(</span><span class="nv">$fila</span> <span class="o">=</span> <span class="nb">mysql_fetch_assoc</span><span class="p">(</span><span class="nv">$resultado</span><span class="p">))</span> <span class="p">{</span>
        <span class="nv">$mensajes</span><span class="p">[]</span> <span class="o">=</span> <span class="nv">$fila</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="nx">cierra_conexion_bd</span><span class="p">(</span><span class="nv">$enlace</span><span class="p">);</span>

    <span class="k">return</span> <span class="nv">$mensajes</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Utilizamos el nombre de archivo <tt class="docutils literal"><span class="pre">modelo.php</span></tt> debido a que el acceso a la lógica y los datos de una aplicación, tradicionalmente, se conoce como la capa del &#8220;modelo&#8221;. En una aplicación bien organizada, la mayoría del código que representa tu &#8220;lógica de negocio&#8221; debe vivir en el modelo (en lugar de vivir en un controlador). Y, a diferencia de este ejemplo, sólo una parte (o ninguna) del modelo realmente está interesada en acceder a la base de datos.</p>
</div>
<p>El controlador (<tt class="docutils literal"><span class="pre">index.php</span></tt>) ahora es muy sencillo:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;modelo.php&#39;</span><span class="p">;</span>

<span class="nv">$mensajes</span> <span class="o">=</span> <span class="nx">obt_todo_mensaje</span><span class="p">();</span>

<span class="k">require</span> <span class="s1">&#39;plantillas/lista.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Ahora, la única tarea del controlador es conseguir los datos de la capa del modelo de la aplicación (el modelo) e invocar a una plantilla que reproduce los datos.
Este es un ejemplo muy simple del patrón modelo-vista-controlador.</p>
</div>
<div class="section" id="aislando-el-diseno">
<h3>Aislando el diseño<a class="headerlink" href="#aislando-el-diseno" title="Permalink to this headline">¶</a></h3>
<p>En este punto, hemos reconstruido la aplicación en tres piezas distintas, mismas que nos ofrecen varias ventajas y la oportunidad de volver a utilizar casi todo en diferentes páginas.</p>
<p>La única parte del código que <em>no</em> se puede reutilizar es el diseño de la página. Corregiremos esto creando un nuevo archivo <tt class="docutils literal"><span class="pre">esbozo.php</span></tt>:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- plantillas/esbozo.php --&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$titulo</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$contenido</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>La plantilla (<tt class="docutils literal"><span class="pre">plantillas/lista.php</span></tt>) ahora se puede simplificar para &#8220;extender&#8221; el diseño:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$titulo</span> <span class="o">=</span> <span class="s1">&#39;Lista de mensajes&#39;</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nb">ob_start</span><span class="p">()</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;h1&gt;</span>Lista de mensajes<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mensajes</span> <span class="k">as</span> <span class="nv">$mensaje</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;/leer?id=</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
            <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$contenido</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;esbozo.php&#39;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Ahora hemos introducido una metodología que nos permite reutilizar el diseño. Desafortunadamente, para lograrlo, estamos obligados a utilizar algunas desagradables funciones de PHP (<tt class="docutils literal"><span class="pre">ob_start()</span></tt>, <tt class="docutils literal"><span class="pre">ob_get_clean()</span></tt>) en la plantilla. Symfony2 utiliza un componente <tt class="docutils literal"><span class="pre">Templating</span></tt> que nos permite realizar esto limpia y fácilmente. En breve lo verás en acción.</p>
</div>
</div>
<div class="section" id="agregando-una-pagina-show-blog">
<h2>Agregando una página &#8220;show&#8221; blog<a class="headerlink" href="#agregando-una-pagina-show-blog" title="Permalink to this headline">¶</a></h2>
<p>La página &#8220;lista&#8221; del blog se ha rediseñado para que el código esté mejor organizado y sea reutilizable. Para probarlo, añade una página &#8220;show&#8221; al blog, que muestre una entrada individual del blog identificada por un parámetro de consulta <tt class="docutils literal"><span class="pre">id</span></tt>.</p>
<p>Para empezar, crea una nueva función en el archivo <tt class="docutils literal"><span class="pre">modelo.php</span></tt> que recupere un resultado individual del blog basándose en un identificador dado:</p>
<div class="highlight-python"><pre>// modelo.php
function obt_mensaje_por_id($id)
{
    $enlace = abre_conexion_bd();

    $id = mysql_real_escape_string($id);
    $consulta = 'SELECT date, titulo, body FROM post WHERE id = '.$id;
    $resultado = mysql_query($consulta);
    $fila = mysql_fetch_assoc($resultado);

    cierra_conexion_bd($enlace);

    return $fila;
}</pre>
</div>
<p>A continuación, crea un nuevo archivo llamado <tt class="docutils literal"><span class="pre">show.php</span></tt> - el controlador para esta nueva página:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="k">require_once</span> <span class="s1">&#39;modelo.php&#39;</span><span class="p">;</span>

<span class="nv">$mensaje</span> <span class="o">=</span> <span class="nx">obt_mensaje_por_id</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>

<span class="k">require</span> <span class="s1">&#39;plantillas/show.php&#39;</span><span class="p">;</span>
</pre></div>
</div>
<p>Por último, crea el nuevo archivo de plantilla - <tt class="docutils literal"><span class="pre">plantillas/show.php</span></tt> - para reproducir una entrada individual del blog:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span> <span class="nv">$titulo</span> <span class="o">=</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nb">ob_start</span><span class="p">()</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;h1&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;titulo&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/h1&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;date&quot;</span><span class="nt">&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span><span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">&quot;body&quot;</span><span class="nt">&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="p">[</span><span class="s1">&#39;body&#39;</span><span class="p">]</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$contenido</span> <span class="o">=</span> <span class="nb">ob_get_clean</span><span class="p">()</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="k">include</span> <span class="s1">&#39;esbozo.php&#39;</span> <span class="cp">?&gt;</span>
</pre></div>
</div>
<p>Ahora, es muy fácil crear la segunda página y sin duplicar código. Sin embargo, esta página introduce problemas aún más perniciosos que una plataforma puede resolver por ti. Por ejemplo, un parámetro <tt class="docutils literal"><span class="pre">id</span></tt> ilegal u omitido en la consulta hará que la página se bloquee. Sería mejor si esto reprodujera una página 404, pero sin embargo, en realidad esto no se puede hacer fácilmente. Peor aún, si olvidaras desinfectar el parámetro <tt class="docutils literal"><span class="pre">id</span></tt> por medio de la función <tt class="docutils literal"><span class="pre">mysql_real_escape_string()</span></tt>, tu base de datos estaría en riesgo de un ataque de inyección SQL.</p>
<p>Otro importante problema es que cada archivo de controlador individual debe incluir al archivo <tt class="docutils literal"><span class="pre">modelo.php</span></tt>. ¿Qué pasaría si cada archivo de controlador de repente tuviera que incluir un archivo adicional o realizar alguna tarea global (por ejemplo, reforzar la seguridad)?
Tal como está ahora, el código tendría que incluir todos los archivos de los controladores.
Si olvidas incluir algo en un solo archivo, esperemos que no sea alguno relacionado con la seguridad...</p>
</div>
<div class="section" id="el-controlador-frontal-al-rescate">
<h2>El &#8220;controlador frontal&#8221; al rescate<a class="headerlink" href="#el-controlador-frontal-al-rescate" title="Permalink to this headline">¶</a></h2>
<p>La solución es utilizar un <a class="reference internal" href="../glossary.html#term-controlador-frontal"><em class="xref std std-term">controlador frontal</em></a>: un único archivo PHP a través del cual se procesan <em>todas</em> las peticiones. Con un controlador frontal, la URI de la aplicación cambia un poco, pero se vuelve más flexible:</p>
<div class="highlight-text"><div class="highlight"><pre>Sin controlador frontal
/index.php          =&gt; (ejecuta index.php) la página lista de mensajes.
/show.php           =&gt; (ejecuta show.php)  la página muestra un mensaje particular.

Con index.php como controlador frontal
/index.php          =&gt; (ejecuta index.php) la página lista de mensajes.
/index.php/show     =&gt; (ejecuta index.php) la página muestra un mensaje particular.
</pre></div>
</div>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">La porción <tt class="docutils literal"><span class="pre">index.php</span></tt> de la URI se puede quitar si se utilizan las reglas de reescritura de Apache (o equivalentes). En ese caso, la URI resultante de la página show del blog simplemente sería <tt class="docutils literal"><span class="pre">/show</span></tt>.</p>
</div>
<p>Cuando se usa un controlador frontal, un solo archivo PHP (<tt class="docutils literal"><span class="pre">index.php</span></tt> en este caso) procesa todas las peticiones. Para la página &#8216;show&#8217; del blog, <tt class="docutils literal"><span class="pre">/index.php/show</span></tt> realmente ejecuta el archivo <tt class="docutils literal"><span class="pre">index.php</span></tt>, que ahora es el responsable de dirigir internamente las peticiones basándose en la URI completa. Como puedes ver, un controlador frontal es una herramienta muy poderosa.</p>
<div class="section" id="creando-el-controlador-frontal">
<h3>Creando el controlador frontal<a class="headerlink" href="#creando-el-controlador-frontal" title="Permalink to this headline">¶</a></h3>
<p>Estás a punto de dar un <strong>gran</strong> paso en la aplicación. Con un archivo manejando todas las peticiones, puedes centralizar cosas tales como el manejo de la seguridad, la carga de configuración y enrutado. En esta aplicación, <tt class="docutils literal"><span class="pre">index.php</span></tt> ahora debe ser lo suficientemente inteligente como para reproducir la lista de entradas del blog <em>o</em> mostrar la página de una entrada particular basándose en la URI solicitada:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>

<span class="c1">// carga e inicia algunas bibliotecas globales</span>
<span class="k">require_once</span> <span class="s1">&#39;modelo.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;controladores.php&#39;</span><span class="p">;</span>

<span class="c1">// encamina la petición internamente</span>
<span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$_SERVER</span><span class="p">[</span><span class="s1">&#39;REQUEST_URI&#39;</span><span class="p">];</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/index.php&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">lista_action</span><span class="p">();</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/index.php/show&#39;</span> <span class="o">&amp;&amp;</span> <span class="nb">isset</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]))</span> <span class="p">{</span>
    <span class="nx">show_action</span><span class="p">(</span><span class="nv">$_GET</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">]);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nb">header</span><span class="p">(</span><span class="s1">&#39;Status: 404 Not Found&#39;</span><span class="p">);</span>
    <span class="k">echo</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Página no encontrada&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Por organización, ambos controladores (antes <tt class="docutils literal"><span class="pre">index.php</span></tt> y <tt class="docutils literal"><span class="pre">show.php</span></tt>) son funciones PHP y cada una se ha movido a un archivo separado, <tt class="docutils literal"><span class="pre">controladores.php</span></tt>:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">function lista_action()</span>
<span class="x">{</span>
<span class="x">    $mensajes = obt_todo_mensaje();</span>
<span class="x">    require &#39;plantillas/lista.php&#39;;</span>
<span class="x">}</span>

<span class="x">function show_action($id)</span>
<span class="x">{</span>
<span class="x">    $mensaje = obt_mensaje_por_id($id);</span>
<span class="x">    require &#39;plantillas/show.php&#39;;</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Como controlador frontal, <tt class="docutils literal"><span class="pre">index.php</span></tt> ha asumido un papel completamente nuevo, el cual incluye la carga de las bibliotecas del núcleo y enrutar la aplicación para invocar a uno de los dos controladores (las funciones <tt class="docutils literal"><span class="pre">lista_action()</span></tt> y <tt class="docutils literal"><span class="pre">show_action()</span></tt>). En realidad, el controlador frontal está empezando a verse y actuar como el mecanismo Symfony2 para la manipulación y enrutado de peticiones.</p>
<div class="admonition tip">
<p class="first admonition-title">Tip</p>
<p class="last">Otra ventaja del controlador frontal es la flexibilidad de las direcciones URL. Ten en cuenta que la URL a la página &#8216;show&#8217; del blog se puede cambiar de <tt class="docutils literal"><span class="pre">/show</span></tt> a <tt class="docutils literal"><span class="pre">/leer</span></tt> cambiando el código solamente en una única ubicación. Antes, era necesario cambiar todo un archivo para cambiar el nombre. En Symfony2, incluso las direcciones URL son más flexibles.</p>
</div>
<p>Por ahora, la aplicación ha evolucionado de un único archivo PHP, a una estructura organizada y permite la reutilización de código. Debes estar feliz, pero aún lejos de estar satisfecho. Por ejemplo, el sistema de &#8220;enrutado&#8221; es voluble, y no reconoce que la página &#8216;lista&#8217; (<tt class="docutils literal"><span class="pre">/index.php</span></tt>) también debe ser accesible a través de <tt class="docutils literal"><span class="pre">/</span></tt> (si se han agregado las reglas de reescritura de Apache). Además, en lugar de desarrollar el blog, una gran cantidad del tiempo se ha gastado trabajando en la &#8220;arquitectura&#8221; del código (por ejemplo, el enrutado, invocando controladores, plantillas, etc.) Se tendrá que gastar más tiempo para manejar la presentación de formularios, validación de entradas, registro de sucesos y seguridad.
¿Por qué tienes que reinventar soluciones a todos estos problemas rutinarios?</p>
</div>
<div class="section" id="anadiendo-un-toque-symfony2">
<h3>Añadiendo un toque Symfony2<a class="headerlink" href="#anadiendo-un-toque-symfony2" title="Permalink to this headline">¶</a></h3>
<p>Symfony2 al rescate. Antes de utilizar Symfony2 realmente, debes asegurarte de que PHP sabe cómo encontrar las clases Symfony2. Esto se logra a través de un cargador automático que proporciona Symfony. Un cargador automático es una herramienta que permite empezar a utilizar clases PHP sin incluir explícitamente el archivo que contiene la clase.</p>
<p>Primero, <a class="reference external" href="http://symfony.com/download">descarga symfony</a> y colócalo en el directorio <tt class="docutils literal"><span class="pre">vendor/symfony/</span></tt>.
A continuación, crea un archivo <tt class="docutils literal"><span class="pre">app/bootstrap.php</span></tt>. Se usa para <tt class="docutils literal"><span class="pre">requerir</span></tt> los dos archivos en la aplicación y para configurar el cargador automático:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// bootstrap.php</span>
<span class="k">require_once</span> <span class="s1">&#39;modelo.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;controladores.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="s1">&#39;vendor/symfony/src/Symfony/Component/ClassLoader/UniversalClassLoader.php&#39;</span><span class="p">;</span>

<span class="nv">$cargador</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Symfony\Component\ClassLoader\UniversalClassLoader</span><span class="p">();</span>
<span class="nv">$cargador</span><span class="o">-&gt;</span><span class="na">registerNamespaces</span><span class="p">(</span><span class="k">array</span><span class="p">(</span>
    <span class="s1">&#39;Symfony&#39;</span> <span class="o">=&gt;</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/vendor/symfony/src&#39;</span><span class="p">,</span>
<span class="p">));</span>

<span class="nv">$cargador</span><span class="o">-&gt;</span><span class="na">register</span><span class="p">();</span>
</pre></div>
</div>
<p>Esto le dice al cargador automático donde están las clases de <tt class="docutils literal"><span class="pre">Symfony</span></tt>. Con esto, puedes comenzar a utilizar las clases de Symfony sin necesidad de utilizar la declaración <tt class="docutils literal"><span class="pre">requiere</span></tt> en los archivos que las utilizan.</p>
<p>La esencia de la filosofía Symfony es la idea de que el trabajo principal de una aplicación es interpretar cada petición y devolver una respuesta. Con este fin, Symfony2 proporciona ambas clases <tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\Request</span></tt> y <tt class="xref py py-class docutils literal"><span class="pre">Symfony\Component\HttpFoundation\Response</span></tt>. Estas clases son representaciones orientadas a objetos de la petición HTTP que se está procesando y la respuesta HTTP que devolverá. Úsalas para mejorar el blog:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// index.php</span>
<span class="k">require_once</span> <span class="s1">&#39;app/bootstrap.php&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Response</span><span class="p">;</span>

<span class="nv">$peticion</span> <span class="o">=</span> <span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">();</span>

<span class="nv">$uri</span> <span class="o">=</span> <span class="nv">$peticion</span><span class="o">-&gt;</span><span class="na">getPathInfo</span><span class="p">();</span>
<span class="k">if</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nv">$respuesta</span> <span class="o">=</span> <span class="nx">lista_action</span><span class="p">();</span>
<span class="p">}</span> <span class="k">elseif</span> <span class="p">(</span><span class="nv">$uri</span> <span class="o">==</span> <span class="s1">&#39;/show&#39;</span> <span class="o">&amp;&amp;</span> <span class="nv">$peticion</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">has</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="nv">$respuesta</span> <span class="o">=</span> <span class="nx">show_action</span><span class="p">(</span><span class="nv">$peticion</span><span class="o">-&gt;</span><span class="na">query</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;id&#39;</span><span class="p">));</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nv">$html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1&gt;Página no encontrada&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
    <span class="nv">$respuesta</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Response</span><span class="p">(</span><span class="nv">$html</span><span class="p">,</span> <span class="mi">404</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// difunde las cabeceras y envía la respuesta</span>
<span class="nv">$respuesta</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>Los controladores son responsables de devolver un objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt>.
Para facilitarnos esto, puedes agregar una nueva función <tt class="docutils literal"><span class="pre">reproduce_plantilla()</span></tt>, la cual, por cierto, actúa un poco como el motor de plantillas de Symfony2:</p>
<div class="highlight-php"><div class="highlight"><pre><span class="x">// controladores.php</span>
<span class="x">use Symfony\Component\HttpFoundation\Response;</span>

<span class="x">function lista_action()</span>
<span class="x">{</span>
<span class="x">    $mensajes = obt_todo_mensaje();</span>
<span class="x">    $html = reproduce_plantilla(&#39;plantillas/lista.php&#39;, array(&#39;posts&#39; =&gt; $mensajes));</span>

<span class="x">    return new Response($html);</span>
<span class="x">}</span>

<span class="x">function show_action($id)</span>
<span class="x">{</span>
<span class="x">    $mensaje = obt_mensaje_por_id($id);</span>
<span class="x">    $html = reproduce_plantilla(&#39;plantillas/show.php&#39;, array(&#39;post&#39; =&gt; $mensaje));</span>

<span class="x">    return new Response($html);</span>
<span class="x">}</span>

<span class="x">// función ayudante para reproducir plantillas</span>
<span class="x">function reproduce_plantilla($ruta, array $args)</span>
<span class="x">{</span>
<span class="x">    extract($args);</span>
<span class="x">    ob_start();</span>
<span class="x">    require $ruta;</span>
<span class="x">    $html = ob_get_clean();</span>

<span class="x">    return $html;</span>
<span class="x">}</span>
</pre></div>
</div>
<p>Al reunir una pequeña parte de Symfony2, la aplicación es más flexible y fiable. La <tt class="docutils literal"><span class="pre">Petición</span></tt> proporciona una manera confiable para acceder a información de la petición HTTP. Especialmente, el método <tt class="docutils literal"><span class="pre">getPathInfo()</span></tt> devuelve una URI limpia (siempre devolviendo <tt class="docutils literal"><span class="pre">/show</span></tt> y nunca <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>).
Por lo tanto, incluso si el usuario va a <tt class="docutils literal"><span class="pre">/index.php/show</span></tt>, la aplicación es lo suficientemente inteligente para encaminar la petición hacia <tt class="docutils literal"><span class="pre">show_action()</span></tt>.</p>
<p>El objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt> proporciona flexibilidad al construir la respuesta HTTP, permitiendo que las cabeceras HTTP y el contenido se agreguen a través de una interfaz orientada a objetos.
Y aunque las respuestas en esta aplicación son simples, esta flexibilidad pagará dividendos en cuanto tu aplicación crezca.</p>
</div>
<div class="section" id="aplicacion-de-ejemplo-en-symfony2">
<h3>Aplicación de ejemplo en Symfony2<a class="headerlink" href="#aplicacion-de-ejemplo-en-symfony2" title="Permalink to this headline">¶</a></h3>
<p>El blog ha <em>avanzado</em>, pero todavía contiene una gran cantidad de código para una aplicación tan simple. De paso, también inventamos un sencillo sistema de enrutado y un método que utiliza <tt class="docutils literal"><span class="pre">ob_start()</span></tt> y <tt class="docutils literal"><span class="pre">ob_get_clean()</span></tt> para procesar plantillas. Si, por alguna razón, necesitas continuar la construcción de esta &#8220;plataforma&#8221; desde cero, por lo menos puedes usar los componentes independientes de Symfony <a class="reference external" href="https://github.com/symfony/Routing">Routing</a> y <a class="reference external" href="https://github.com/symfony/Templating">Templating</a>, que resuelven estos problemas.</p>
<p>En lugar de resolver problemas comunes de nuevo, puedes dejar que Symfony2 se preocupe de ellos por ti. Aquí está la misma aplicación de ejemplo, ahora construida en Symfony2:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// src/Acme/BlogBundle/Controller/BlogController.php</span>

<span class="k">namespace</span> <span class="nx">Acme\BlogBundle\Controller</span><span class="p">;</span>
<span class="k">use</span> <span class="nx">Symfony\Bundle\FrameworkBundle\Controller\Controller</span><span class="p">;</span>

<span class="k">class</span> <span class="nc">BlogController</span> <span class="k">extends</span> <span class="nx">Controller</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">function</span> <span class="nf">listAction</span><span class="p">()</span>
    <span class="p">{</span>
        <span class="nv">$mensajes</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">)</span><span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">createQuery</span><span class="p">(</span><span class="s1">&#39;SELECT p FROM AcmeBlogBundle:Post p&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">execute</span><span class="p">();</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post:lista.html.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;posts&#39;</span> <span class="o">=&gt;</span> <span class="nv">$mensajes</span><span class="p">));</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="k">function</span> <span class="nf">showAction</span><span class="p">(</span><span class="nv">$id</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="nv">$mensaje</span> <span class="o">=</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">get</span><span class="p">(</span><span class="s1">&#39;doctrine&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">getEntityManager</span><span class="p">()</span>
            <span class="o">-&gt;</span><span class="na">getRepository</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post&#39;</span><span class="p">)</span>
            <span class="o">-&gt;</span><span class="na">find</span><span class="p">(</span><span class="nv">$id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nv">$mensaje</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// provoca que se muestre el error 404 Página no encontrada</span>
            <span class="k">throw</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">createNotFoundException</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="nv">$this</span><span class="o">-&gt;</span><span class="na">render</span><span class="p">(</span><span class="s1">&#39;AcmeBlogBundle:Post:show.html.php&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;post&#39;</span> <span class="o">=&gt;</span> <span class="nv">$mensaje</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Los dos controladores siguen siendo ligeros. Cada uno utiliza la biblioteca ORM de Doctrine para recuperar objetos de la base de datos y el componente <tt class="docutils literal"><span class="pre">Templating</span></tt> para reproducir una plantilla y devolver un objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt>. La plantilla lista ahora es un poco más simple:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- src/Acme/BlogBundle/Resources/views/Blog/lista.html.php --&gt;</span>
<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="o">-&gt;</span><span class="na">extend</span><span class="p">(</span><span class="s1">&#39;::base.html.php&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

<span class="cp">&lt;?php</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">set</span><span class="p">(</span><span class="s1">&#39;titulo&#39;</span><span class="p">,</span> <span class="s1">&#39;Lista de mensajes&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>

<span class="nt">&lt;h1&gt;</span>Lista de mensajes<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;ul&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">foreach</span> <span class="p">(</span><span class="nv">$mensajes</span> <span class="k">as</span> <span class="nv">$mensaje</span><span class="p">)</span><span class="o">:</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;li&gt;</span>
        <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;router&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">generate</span><span class="p">(</span><span class="s1">&#39;blog_show&#39;</span><span class="p">,</span> <span class="k">array</span><span class="p">(</span><span class="s1">&#39;id&#39;</span> <span class="o">=&gt;</span> <span class="nv">$mensaje</span><span class="o">-&gt;</span><span class="na">getId</span><span class="p">()))</span> <span class="cp">?&gt;</span><span class="s">&quot;</span><span class="nt">&gt;</span>
            <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$mensaje</span><span class="o">-&gt;</span><span class="na">getTitulo</span><span class="p">()</span> <span class="cp">?&gt;</span>
        <span class="nt">&lt;/a&gt;</span>
    <span class="nt">&lt;/li&gt;</span>
    <span class="cp">&lt;?php</span> <span class="k">endforeach</span><span class="p">;</span> <span class="cp">?&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</pre></div>
</div>
<p>El diseño es casi idéntico:</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="c">&lt;!-- app/Resources/views/base.html.php --&gt;</span>
<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">&#39;titulo&#39;</span><span class="p">,</span> <span class="s1">&#39;Default titulo&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">&lt;?php</span> <span class="k">echo</span> <span class="nv">$view</span><span class="p">[</span><span class="s1">&#39;slots&#39;</span><span class="p">]</span><span class="o">-&gt;</span><span class="na">output</span><span class="p">(</span><span class="s1">&#39;_content&#39;</span><span class="p">)</span> <span class="cp">?&gt;</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Te vamos a dejar como ejercicio la plantilla &#8216;show&#8217;, porque debería ser trivial crearla basándote en la plantilla lista.</p>
</div>
<p>Cuando arranca el motor Symfony2 (llamado <tt class="docutils literal"><span class="pre">kernel</span></tt>), necesita un mapa para saber qué controladores ejecutar basándose en la información solicitada.
Un mapa de configuración de enrutado proporciona esta información en formato legible:</p>
<div class="highlight-python"><pre># app/config/routing.yml
blog_list:
    pattern:  /blog
    defaults: { _controller: AcmeBlogBundle:Blog:lista }

blog_show:
    pattern:  /blog/show/{id}
    defaults: { _controller: AcmeBlogBundle:Blog:show }</pre>
</div>
<p>Ahora que Symfony2 se encarga de todas las tareas rutinarias, el controlador frontal es muy simple. Y ya que hace tan poco, nunca tienes que volver a tocarlo una vez creado (y si utilizas una distribución Symfony2, ¡ni siquiera tendrás que crearlo!):</p>
<div class="highlight-html+php"><div class="highlight"><pre><span class="cp">&lt;?php</span>
<span class="c1">// web/app.php</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../app/bootstrap.php&#39;</span><span class="p">;</span>
<span class="k">require_once</span> <span class="nx">__DIR__</span><span class="o">.</span><span class="s1">&#39;/../app/AppKernel.php&#39;</span><span class="p">;</span>

<span class="k">use</span> <span class="nx">Symfony\Component\HttpFoundation\Request</span><span class="p">;</span>

<span class="nv">$nucleo</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">AppKernel</span><span class="p">(</span><span class="s1">&#39;prod&#39;</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
<span class="nv">$nucleo</span><span class="o">-&gt;</span><span class="na">handle</span><span class="p">(</span><span class="nx">Request</span><span class="o">::</span><span class="na">createFromGlobals</span><span class="p">())</span><span class="o">-&gt;</span><span class="na">send</span><span class="p">();</span>
</pre></div>
</div>
<p>El único trabajo del controlador frontal es iniciar el motor de Symfony2 (el <tt class="docutils literal"><span class="pre">núcleo</span></tt>) y pasarle un objeto <tt class="docutils literal"><span class="pre">Petición</span></tt> para que lo manipule. El núcleo de Symfony2 entonces utiliza el mapa de enrutado para determinar qué controlador invocar. Al igual que antes, el método controlador es el responsable de devolver el objeto <tt class="docutils literal"><span class="pre">Respuesta</span></tt> final.
Realmente no hay mucho más sobre él.</p>
<p>Para conseguir una representación visual de cómo maneja Symfony2 cada petición, consulta el <a class="reference internal" href="http_fundamentals.html#request-flow-figure"><em>diagrama de flujo de la petición</em></a>.</p>
</div>
<div class="section" id="que-mas-ofrece-symfony2">
<h3>Qué más ofrece Symfony2<a class="headerlink" href="#que-mas-ofrece-symfony2" title="Permalink to this headline">¶</a></h3>
<p>En los siguientes capítulos, aprenderás más acerca de cómo funciona cada pieza de Symfony y la organización recomendada de un proyecto. Por ahora, vamos a ver cómo, migrar el blog de PHP simple a Symfony2 nos ha mejorado la vida:</p>
<ul class="simple">
<li>Tu aplicación cuenta con <strong>código claro y organizado consistentemente</strong> (aunque Symfony no te obliga a ello). Promueve la <strong>reutilización</strong> y permite a los nuevos desarrolladores ser productivos en el proyecto con mayor rapidez.</li>
<li>100% del código que escribes es para <em>tu</em> aplicación. <strong>No necesitas desarrollar o mantener servicios públicos de bajo nivel</strong> tales como la <a class="reference internal" href="page_creation.html#autoloading-introduction-sidebar"><em>carga automática</em></a> de clases, el <a class="reference internal" href="routing.html"><em>enrutado</em></a> o la reproducción de <a class="reference internal" href="controller.html"><em>controladores</em></a>.</li>
<li>Symfony2 te proporciona <strong>acceso a herramientas de código abierto</strong> tales como Doctrine, plantillas, seguridad, formularios, validación y traducción (por nombrar algunas).</li>
<li>La aplicación ahora disfruta de <strong>direcciones URL totalmente flexibles</strong> gracias al componente <tt class="docutils literal"><span class="pre">Routing</span></tt>.</li>
<li>La arquitectura centrada en HTTP de Symfony2 te da acceso a poderosas herramientas, tal como la <strong>memoria caché HTTP</strong> impulsadas por la <strong>caché HTTP interna de Symfony2</strong> o herramientas más poderosas, tales como <a class="reference external" href="http://www.varnish-cache.org">Varnish</a>. Esto se trata posteriormente en el capítulo todo sobre <a class="reference internal" href="http_cache.html"><em>caché</em></a>.</li>
</ul>
<p>Y lo mejor de todo, utilizando Symfony2, ¡ahora tienes acceso a un conjunto de herramientas de <strong>alta calidad de código abierto desarrolladas por la comunidad Symfony2</strong>!
Para más información, visita <a class="reference external" href="http://symfony2bundles.org">Symfony2Bundles.org</a></p>
</div>
</div>
<div class="section" id="mejores-plantillas">
<h2>Mejores plantillas<a class="headerlink" href="#mejores-plantillas" title="Permalink to this headline">¶</a></h2>
<p>Si decides utilizarlo, Symfony2 de serie viene con un motor de plantillas llamado <a class="reference external" href="http://www.twig-project.org">Twig</a> el cual hace que las plantillas se escriban más rápido y sean más fáciles de leer.
Esto significa que, incluso, ¡la aplicación de ejemplo podría contener mucho menos código! Tomemos, por ejemplo, la plantilla lista escrita en Twig:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# src/Acme/BlogBundle/Resources/views/Blog/lista.html.twig #}</span>

<span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;::base.html.twig&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">block</span> <span class="nv">titulo</span> <span class="cp">%}</span>Lista de mensajes<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}</span>
    <span class="nt">&lt;h1&gt;</span>Lista de mensajes<span class="nt">&lt;/h1&gt;</span>
    <span class="nt">&lt;ul&gt;</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">post</span> <span class="k">in</span> <span class="nv">posts</span> <span class="cp">%}</span>
        <span class="nt">&lt;li&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">path</span><span class="o">(</span><span class="s1">&#39;blog_show&#39;</span><span class="o">,</span> <span class="o">{</span> <span class="s1">&#39;id&#39;</span><span class="o">:</span> <span class="nv">post.id</span> <span class="o">})</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="nt">&gt;</span>
                <span class="cp">{{</span> <span class="nv">post.titulo</span> <span class="cp">}}</span>
            <span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/li&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="nt">&lt;/ul&gt;</span>
<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>También es fácil escribir la plantilla <tt class="docutils literal"><span class="pre">base.html.twig</span></tt> correspondiente:</p>
<div class="highlight-html+jinja"><div class="highlight"><pre><span class="c">{# app/Resources/views/base.html.twig #}</span>

<span class="nt">&lt;html&gt;</span>
    <span class="nt">&lt;head&gt;</span>
        <span class="nt">&lt;title&gt;</span><span class="cp">{%</span> <span class="k">block</span> <span class="nv">titulo</span> <span class="cp">%}</span>Título predefinido<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span><span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;/head&gt;</span>
    <span class="nt">&lt;body&gt;</span>
        <span class="cp">{%</span> <span class="k">block</span> <span class="nv">body</span> <span class="cp">%}{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
    <span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Twig es compatible con Symfony2. Y si bien las plantillas PHP siempre contarán con el apoyo de Symfony2, vamos a seguir explicando muchas de las ventajas de Twig. Para más información, consulta el capítulo <a class="reference internal" href="templating.html"><em>Plantillas</em></a>.</p>
</div>
<div class="section" id="aprende-mas-en-el-recetario">
<h2>Aprende más en el recetario<a class="headerlink" href="#aprende-mas-en-el-recetario" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><a class="reference internal" href="../cookbook/templating/PHP.html"><em>Cómo usar plantillas PHP en lugar de Twig</em></a></li>
<li><a class="reference internal" href="../cookbook/controller/service.html"><em>Cómo definir controladores como servicios</em></a></li>
</ul>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Symfony2 frente a PHP simple</a><ul>
<li><a class="reference internal" href="#un-sencillo-blog-en-php-simple">Un sencillo blog en PHP simple</a><ul>
<li><a class="reference internal" href="#aislando-la-presentacion">Aislando la presentación</a></li>
<li><a class="reference internal" href="#aislando-la-logica-de-la-aplicacion-el-dominio">Aislando la lógica de la aplicación (el dominio)</a></li>
<li><a class="reference internal" href="#aislando-el-diseno">Aislando el diseño</a></li>
</ul>
</li>
<li><a class="reference internal" href="#agregando-una-pagina-show-blog">Agregando una página &#8220;show&#8221; blog</a></li>
<li><a class="reference internal" href="#el-controlador-frontal-al-rescate">El &#8220;controlador frontal&#8221; al rescate</a><ul>
<li><a class="reference internal" href="#creando-el-controlador-frontal">Creando el controlador frontal</a></li>
<li><a class="reference internal" href="#anadiendo-un-toque-symfony2">Añadiendo un toque Symfony2</a></li>
<li><a class="reference internal" href="#aplicacion-de-ejemplo-en-symfony2">Aplicación de ejemplo en Symfony2</a></li>
<li><a class="reference internal" href="#que-mas-ofrece-symfony2">Qué más ofrece Symfony2</a></li>
</ul>
</li>
<li><a class="reference internal" href="#mejores-plantillas">Mejores plantillas</a></li>
<li><a class="reference internal" href="#aprende-mas-en-el-recetario">Aprende más en el recetario</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="http_fundamentals.html"
                        title="previous chapter">Symfony2 y fundamentos HTTP</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="installation.html"
                        title="next chapter">Instalando y configurando Symfony</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/book/from_flat_php_to_symfony2.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" size="18" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="installation.html" title="Instalando y configurando Symfony"
             >next</a> |</li>
        <li class="right" >
          <a href="http_fundamentals.html" title="Symfony2 y fundamentos HTTP"
             >previous</a> |</li>
        <li><a href="../index.html">symfony-docs-es v1 documentation</a> &raquo;</li>
          <li><a href="index.html" >Libro</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2011, Osukaru.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.0.7.
    </div>
  </body>
</html>